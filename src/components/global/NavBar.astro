---
import { supportedLocales } from "../../locals/languages";
import { ChartNoAxesGantt, Languages, Moon, Sun, CircleX } from "@lucide/astro";

const theme = Astro.cookies.get("theme") || { value: "light" };
---

<nav class="fixed top-0 left-0 shadow-2xl right-0 z-50 backdrop-blur-md bg-background/40">
  <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between">

    <a href="/" class="flex items-center gap-3">
      <img src="/favicon.svg" alt="logo" class="h-8 w-8" />
      <span class="font-semibold tracking-wide flex text-lg text-foreground">
        IHRO<p class="hidden md:block"> â€” International Human Rights Organization</p>
      </span>
    </a>

    <div class="flex items-center gap-3 md:gap-4 relative">

      <button id="themebtn" class="p-2 rounded-md hover:bg-muted transition">
        <Moon class={theme ? "hidden" : "block"} id="moon" />
        <Sun class={theme ? "block" : "hidden"} id="sun" />
      </button>

      <!-- Language Dropdown -->
      <div class="relative">
        <button
          class="px-2 py-1.5 flex gap-2 items-center rounded-md hover:bg-muted transition"
          onclick="document.getElementById('langMenu').classList.toggle('hidden')"
        >
          <Languages class="h-5 w-5" />
          <span class="hidden md:block text-sm">
            {
              supportedLocales.map((locale) =>
                locale.code == Astro.params.local ? locale.label : ""
              )
            }
          </span>
        </button>

        <!-- Dropdown -->
        <div
          id="langMenu"
          class="hidden absolute right-0 mt-2 w-40 rounded-md shadow-md overflow-hidden bg-background border border-border"
        >
          {
            supportedLocales.map((locale) => (
              <a
                href={`/${locale.code}`}
                class="block px-4 py-2 hover:bg-foreground hover:text-background text-sm transition"
              >
                {locale.label}
              </a>
            ))
          }
        </div>
      </div>

      <!-- Mobile Menu / Activity -->
      <button
        id="activitybtn"
        class="p-2 rounded-md hover:bg-muted transition md:hidden"
      >
        <ChartNoAxesGantt id="menu-open" class="h-5 w-5" />
        <CircleX id="menu-close" class="hidden h-5 w-5" />
      </button>

    </div>
  </div>
</nav>

<script>
  const activitybtn = document.getElementById("activitybtn");
  const themebtn = document.getElementById("themebtn");
  const sun = document.getElementById("sun");
  const moon = document.getElementById("moon");
  const menuOpen = document.getElementById("menu-open");
  const menuClose = document.getElementById("menu-close");

  let active = false;

  activitybtn?.addEventListener("click", () => {
    active = !active;
    const event = new CustomEvent(active ? "sidebar:open" : "sidebar:close", {
      detail: { from: "button", time: Date.now() },
      bubbles: true,
      composed: true,
    });
    document.dispatchEvent(event);
    menuOpen?.classList.toggle("hidden");
    menuClose?.classList.toggle("hidden");
  });

  themebtn?.addEventListener("click", () => {
    const currentTheme = document.documentElement.dataset.theme || "light";
    const newTheme = currentTheme === "light" ? "dark" : "light";
    document.cookie = `theme=${newTheme}; path=/; max-age=31536000`;
    document.documentElement.dataset.theme = newTheme;
    sun?.classList.toggle("hidden");
    moon?.classList.toggle("hidden");
  });
</script>
